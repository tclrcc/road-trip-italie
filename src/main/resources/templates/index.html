<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <title>Road Trip Italie 2026</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Import feuilles css librairies -->
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/leaflet.css}" rel="stylesheet">
    <link th:href="@{/css/font-awesome.min.css}" rel="stylesheet">

    <!-- Import feuille css index -->
    <link th:href="@{/css/index.css}" rel="stylesheet">
</head>
<body>

<div class="hero-section text-center shadow">
    <div class="container position-relative">
        <form th:action="@{/logout}" method="post" class="position-absolute top-0 end-0 m-3">
            <button type="submit" class="btn btn-sm btn-outline-light">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </form>

        <h1 class="display-6 fw-bold"><i class="fas fa-route"></i> Grand Tour d'Italie 2026</h1>

        <p class="mb-2">
            Bienvenue <span class="fw-bold" th:text="${#authentication.name}">Voyageur</span> !
            ‚Ä¢ <span th:text="${duration}"></span> Jours de Dolce Vita
        </p>

        <div th:if="${daysBeforeStart > 0}" class="badge bg-light text-primary fs-6 mt-2">
            üöÄ D√©part dans <span th:text="${daysBeforeStart}"></span> jours
        </div>
        <div th:unless="${daysBeforeStart > 0}" class="badge bg-warning text-dark fs-6 mt-2">
            ‚úàÔ∏è Bon voyage !
        </div>
    </div>
</div>

<div class="container">

    <div class="row mb-4">
        <div class="col-12">
            <div class="card p-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="m-0 text-secondary"><i class="fas fa-wallet"></i> Suivi Budget</h5>
                    <span class="fw-bold fs-5 text-dark"><span th:text="${#numbers.formatDecimal(totalBudget, 0, 0)}"></span> ‚Ç¨ <small class="text-muted text-small">/ 4000 ‚Ç¨</small></span>
                </div>
                <div class="progress">
                    <div class="progress-bar bg-success" role="progressbar"
                         th:style="'width: ' + ${(paidAmount / totalBudget) * 100} + '%'"
                         th:text="'Pay√©: ' + ${#numbers.formatDecimal(paidAmount, 0, 0)} + '‚Ç¨'">
                    </div>
                    <div class="progress-bar bg-warning text-dark" role="progressbar"
                         th:style="'width: ' + ${(remainingToPay / totalBudget) * 100} + '%'"
                         th:text="'Reste: ' + ${#numbers.formatDecimal(remainingToPay, 0, 0)} + '‚Ç¨'">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h5 class="text-muted mb-3"><i class="fas fa-map-marked-alt"></i> Carte du Voyage</h5>
    <div id="map"></div>

    <h5 class="text-muted mb-3"><i class="fas fa-bed"></i> Mes Hubs (Logements)</h5>
    <div class="row flex-nowrap overflow-auto pb-3 mb-3">
        <div class="col-md-4 col-10" th:each="acc : ${accommodations}">
            <div class="card h-100 border-start border-4 accommodation-card"
                 th:classappend="${acc.paid} ? 'border-success' : 'border-warning'"
                 th:data-lat="${acc.latitude}"
                 th:data-lng="${acc.longitude}"
                 th:data-name="${acc.name}">

                <div class="card-body">
                    <h6 class="card-title fw-bold text-truncate" th:text="${acc.name}"></h6>
                    <p class="small text-muted mb-2"><i class="fas fa-map-marker-alt"></i> <span th:text="${acc.location}"></span></p>

                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <span class="badge" th:classappend="${acc.paid} ? 'bg-success' : 'bg-warning text-dark'"
                              th:text="${acc.paid} ? 'PAY√â' : '√Ä PAYER'"></span>
                        <span class="fw-bold"><span th:text="${acc.cost}"></span> ‚Ç¨</span>
                    </div>

                    <a th:href="${acc.airbnbLink}" target="_blank" class="btn btn-sm btn-outline-primary w-100 mt-2">
                        <i class="fab fa-airbnb"></i> Voir R√©servation
                    </a>
                </div>
            </div>
        </div>
    </div>

    <h5 class="text-muted mb-3"><i class="fas fa-folder-open"></i> Coffre-fort Num√©rique</h5>
    <div class="card mb-4 p-3 shadow-sm border-0">
        <div class="row align-items-center">

            <div class="col-md-4 mb-3 mb-md-0 border-end">
                <h6 class="fw-bold mb-2">Ajouter un document</h6>
                <form method="POST" th:action="@{/uploadDoc}" enctype="multipart/form-data" class="d-flex gap-2">
                    <input type="file" name="file" class="form-control form-control-sm" required>
                    <button type="submit" class="btn btn-sm btn-primary"><i class="fas fa-upload"></i></button>
                </form>
                <small class="text-muted fst-italic">Billets, ID, R√©sas...</small>
            </div>

            <div class="col-md-8">
                <h6 class="fw-bold mb-2">Mes Fichiers (<span th:text="${documents.size()}"></span>)</h6>

                <div th:if="${documents.isEmpty()}" class="text-muted small">Aucun document enregistr√©.</div>

                <div class="d-flex flex-wrap gap-2">
                    <div th:each="doc : ${documents}" class="btn-group" role="group">
                        <a th:href="@{'/document/' + ${doc.id}}" target="_blank" class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-file-pdf text-danger" th:if="${doc.type.contains('pdf')}"></i>
                            <i class="fas fa-file-image text-primary" th:if="${doc.type.contains('image')}"></i>
                            <i class="fas fa-file text-muted" th:unless="${doc.type.contains('pdf') || doc.type.contains('image')}"></i>
                            <span th:text="${doc.name}" class="ms-1"></span>
                        </a>
                        <a th:href="@{'/deleteDoc/' + ${doc.id}}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Supprimer ce fichier ?')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h5 class="text-muted mb-3"><i class="fas fa-calendar-alt"></i> Itin√©raire Jour par Jour</h5>
    <div class="row">
        <div class="col-12">

            <div th:each="day : ${days}" class="card mb-3" th:classappend="${day.warningZTL} ? 'ztl-alert' : ''">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-3 col-md-2 border-end text-center">
                            <span class="timeline-day-name" th:text="${#temporals.format(day.date, 'EEEE')}"></span>
                            <span class="timeline-date" th:text="${#temporals.format(day.date, 'dd MMM')}"></span>
                        </div>

                        <div class="col-9 col-md-8">
                            <div class="d-flex align-items-center gap-2 mb-1">
                                <span class="hub-tag"><i class="fas fa-home"></i> <span th:text="${day.hubLocation}"></span></span>
                                <span th:if="${day.warningZTL}" class="badge badge-ztl"><i class="fas fa-exclamation-triangle"></i> ZTL !</span>
                            </div>

                            <h5 class="fw-bold mb-1" th:text="${day.title}"></h5>
                            <p class="text-secondary mb-1 small" th:text="${day.mainActivity}"></p>

                            <div th:if="${day.logisticsTip != null && !day.logisticsTip.isEmpty()}" class="mt-2 p-2 bg-light rounded border border-info text-info small">
                                <i class="fas fa-lightbulb"></i> <strong>Logistique :</strong> <span th:text="${day.logisticsTip}"></span>
                            </div>
                        </div>

                        <div class="col-12 col-md-2 text-md-end text-center mt-3 mt-md-0 border-start-md ps-md-3">
                            <small class="text-muted d-block">Budget Jour</small>
                            <span class="fs-5 fw-bold text-dark"><span th:text="${day.dailyBudget}"></span> ‚Ç¨</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="text-center py-4 text-muted small">
        &copy; 2026 RoadTrip App - Tony
    </div>

</div>

<!-- Import JS Libraires (Bootstrap + Map Terre) -->
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/leaflet.js}"></script>
<script th:src="@{/js/roadtrip-map.js}"></script>

</body>
</html>
